/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define("esri/map",["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/event","dojo/on","dojo/aspect","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/registry","esri/kernel","esri/config","esri/sniff","esri/lang","esri/_coremap","esri/MapNavigationManager"],function(_1,_2,_3,_4,_5,_6,_7,on,_8,_9,_a,_b,_c,_d,_e,_f,_10,has,_11,_12,_13){var _14=30,_15=30,_16={up:"panUp",right:"panRight",down:"panDown",left:"panLeft"},_17={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"},dc=_4.connect,ddc=_4.disconnect,dcr=_b.create,ds=_d.set,dh=_5.hitch,_18=_c.getMarginBox,_19=_2.deprecated,_1a=_5.mixin,_1b="Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",_1c=0;var Map=_3(_12,{declaredClass:"esri.Map",constructor:function(_1d,_1e){_1a(this,{_slider:null,_navDiv:null,_mapParams:_1a({attributionWidth:0.45,slider:true,nav:false,logo:true,sliderStyle:"small",sliderPosition:"top-left",sliderOrientation:"vertical",autoResize:true},_1e||{})});_1a(this,{isDoubleClickZoom:false,isShiftDoubleClickZoom:false,isClickRecenter:false,isScrollWheelZoom:false,isPan:false,isRubberBandZoom:false,isKeyboardNavigation:false,isPanArrows:false,isZoomSlider:false});if(_5.isFunction(_f._css)){_f._css=_f._css(this._mapParams.force3DTransforms);this.force3DTransforms=this._mapParams.force3DTransforms;}var _1f=(has("esri-transforms")&&has("esri-transitions"));this.navigationMode=this._mapParams.navigationMode||(_1f&&"css-transforms")||"classic";if(this.navigationMode==="css-transforms"&&!_1f){this.navigationMode="classic";}this.fadeOnZoom=_11.isDefined(this._mapParams.fadeOnZoom)?this._mapParams.fadeOnZoom:(this.navigationMode==="css-transforms");if(this.navigationMode!=="css-transforms"){this.fadeOnZoom=false;}this.setMapCursor("default");this.smartNavigation=_1e&&_1e.smartNavigation;if(!_11.isDefined(this.smartNavigation)&&has("mac")&&!has("esri-touch")&&!has("esri-pointer")&&!(has("ff")<=3.5)){var _20=navigator.userAgent.match(/Mac\s+OS\s+X\s+([\d]+)(\.|\_)([\d]+)\D/i);if(_20&&_11.isDefined(_20[1])&&_11.isDefined(_20[3])){var _21=parseInt(_20[1],10),_22=parseInt(_20[3],10);this.smartNavigation=((_21>10)||(_21===10&&_22>=6));}}var _23=true;_23=false;this.showAttribution=_11.isDefined(this._mapParams.showAttribution)?this._mapParams.showAttribution:_23;this._onLoadHandler_connect=dc(this,"onLoad",this,"_onLoadInitNavsHandler");var _24=dcr("div",{"class":"esriControlsBR"+(this._mapParams.nav?" withPanArrows":"")},this.root);if(this.showAttribution){var _25=_5.getObject("esri.dijit.Attribution",false);if(_25){this._initAttribution(_25,_24);}else{var _26=["esri/dijit/Attribution"],rid=_1c++,_27=this;this._rids&&this._rids.push(rid);_1(_26,function(_28){var idx=_27._rids?_6.indexOf(_27._rids,rid):-1;if(idx!==-1){_27._rids.splice(idx,1);_27._initAttribution(_28,_24);}});}}if(this._mapParams.logo){var _29={};if(has("ie")===6){_29.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+_1.toUrl("esri")+"/images/map/logo-med.png"+"')";}var _2a=this._ogol=dcr("div",{style:_29},_24);if((this.root.clientWidth*this.root.clientHeight)<250000){_a.add(_2a,"logo-sm");}else{_a.add(_2a,"logo-med");}if(!has("esri-touch")&&!has("esri-pointer")){this._ogol_connect=dc(_2a,"onclick",this,"_openLogoLink");}}var _2b=(this.navigationManager=new _13(this)),_2c=_2b.mouseEvents||_2b.touchEvents||_2b.pointerEvents;if(_1e&&_1e.basemap){this._onLoadFix=true;this.setBasemap(_1e.basemap);this._onLoadFix=false;}this.autoResize=this._mapParams.autoResize;if(this.autoResize){var _2d=_e.getEnclosingWidget(this.container),_2e=(_2d&&_2d.resize)?_2d:window,_2f=dh(this,this.resize);this._rszSignal=on.pausable(_2e,"resize",_2f);this._oriSignal=on.pausable(window,"orientationchange",_2f);_8.after(_2e,"resize",_2f,true);}},_initAttribution:function(_30,_31){var _32=dcr("span",{"class":"esriAttribution"},_31,"first");ds(_32,"width",Math.floor(this.width*this._mapParams.attributionWidth)+"px");this._connects.push(dc(_32,"onclick",function(){var _33="esriAttributionOpen";if(_a.contains(this,_33)){_a.remove(this,_33);}else{if(this.scrollWidth>this.clientWidth){_a.add(this,_33);}}}));this.attribution=new _30({map:this},_32);},_cleanUp:function(){this.disableMapNavigation();this.navigationManager.destroy();var _34=this._slider;if(_34&&_34.destroy&&!_34._destroyed){_34.destroy();}var _35=this._navDiv,_36=this.attribution;if(_35){_b.destroy(_35);}if(_36){_36.destroy();}this._connects.push(this._slider_connect,this._ogol_connect,this._rszSignal,this._oriSignal);_6.forEach(this._connects,ddc);this.attribution=this.navigationManager=this._rids=this._connects=this._slider_connect=this._ogol_connect=this._rszSignal=this._oriSignal=null;this.inherited("_cleanUp",arguments);},_isPanningOrZooming:function(){return this.__panning||this.__zooming;},_canZoom:function(_37){var _38=this.getLevel();return !this.__tileInfo||!((_38===this.getMinZoom()&&_37<0)||(_38===this.getMaxZoom()&&_37>0));},_onLoadInitNavsHandler:function(){this.enableMapNavigation();this._createNav();if(this._mapParams.sliderStyle==="small"||!this._createSlider){this._createSimpleSlider();}else{if(this._mapParams.slider){var _39=this._getSliderClass(true),_3a=(_39.indexOf("Horizontal")!==-1),_3b=_3a?"dijit.form.HorizontalSlider":"dijit.form.VerticalSlider",_3c=_3a?"dijit.form.HorizontalRule":"dijit.form.VerticalRule",_3d=_3a?"dijit.form.HorizontalRuleLabels":"dijit.form.VerticalRuleLabels",_3e=[_3b,_3c,_3d],_3f=_6.some(_3e,function(_40){return !_5.getObject(_40,false);});if(_3f){_3e=_6.map(_3e,function(_41){return _41.replace(/\./g,"/");});var rid=_1c++,_42=this;this._rids&&this._rids.push(rid);_1(_3e,function(){var idx=_42._rids?_6.indexOf(_42._rids,rid):-1;if(idx!==-1){_42._rids.splice(idx,1);_42._createSlider.apply(_42,arguments);}});}else{_3e=_6.map(_3e,function(_43){return _5.getObject(_43,false);});this._createSlider.apply(this,_3e);}}}ddc(this._onLoadHandler_connect);},_createNav:function(){if(this._mapParams.nav){var div,v,i,_44=_a.add,id=this.id;this._navDiv=dcr("div",{id:id+"_navdiv"},this.root);_44(this._navDiv,"navDiv");var w2=this.width/2,h2=this.height/2,wh;for(i in _16){v=_16[i];div=dcr("div",{id:id+"_pan_"+i},this._navDiv);_44(div,"fixedPan "+v);if(i==="up"||i==="down"){wh=parseInt(_18(div).w,10)/2;ds(div,{left:(w2-wh)+"px",zIndex:_14});}else{wh=parseInt(_18(div).h,10)/2;ds(div,{top:(h2-wh)+"px",zIndex:_14});}this._connects.push(dc(div,"onclick",dh(this,this[v])));}this._onMapResizeNavHandler_connect=dc(this,"onResize",this,"_onMapResizeNavHandler");for(i in _17){v=_17[i];div=dcr("div",{id:id+"_pan_"+i,style:{zIndex:_14}},this._navDiv);_44(div,"fixedPan "+v);this._connects.push(dc(div,"onclick",dh(this,this[v])));}this.isPanArrows=true;}},_onMapResizeNavHandler:function(_45,wd,ht){var id=this.id,w2=wd/2,h2=ht/2,_46=_9.byId,i,div,wh;for(i in _16){div=_46(id+"_pan_"+i);if(i==="up"||i==="down"){wh=parseInt(_18(div).w,10)/2;ds(div,"left",(w2-wh)+"px");}else{wh=parseInt(_18(div).h,10)/2;ds(div,"top",(h2-wh)+"px");}}},_createSimpleSlider:function(){if(this._mapParams.slider){var _47=(this._slider=dcr("div",{id:this.id+"_zoom_slider","class":this._getSliderClass(),style:{zIndex:_15}})),_48=(has("esri-touch")&&!has("ff"))?"touchstart":(has("esri-pointer")?(navigator.msPointerEnabled?"MSPointerDown":"pointerdown"):"onclick"),_49=dcr("div",{"class":"esriSimpleSliderIncrementButton"},_47),_4a=dcr("div",{"class":"esriSimpleSliderDecrementButton"},_47);_49.innerHTML="+";_4a.innerHTML="&ndash;";if(has("ie")<8){_a.add(_4a,"dj_ie67Fix");}this._connects.push(dc(_49,_48,this,this._simpleSliderChangeHandler));this._connects.push(dc(_4a,_48,this,this._simpleSliderChangeHandler));if(_48=="touchstart"){this._connects.push(dc(_49,"onclick",this,this._simpleSliderChangeHandler));this._connects.push(dc(_4a,"onclick",this,this._simpleSliderChangeHandler));}if(has("ie")<10){_9.setSelectable(_47,false);}this.root.appendChild(_47);this.isZoomSlider=true;}},_simpleSliderChangeHandler:function(evt){_7.stop(evt);var _4b=(evt.currentTarget.className.indexOf("IncrementButton")!==-1)?true:false;this._extentUtil({numLevels:_4b?1:-1});},_getSliderClass:function(_4c){var _4d="",_4e=(_4c?"Large":"Simple"),_4f=this._mapParams.sliderOrientation,_50=this._mapParams.sliderPosition||"";_4f=(_4f&&_4f.toLowerCase()==="horizontal")?"esri"+_4e+"SliderHorizontal":"esri"+_4e+"SliderVertical";if(_50){switch(_50.toLowerCase()){case "top-left":_50="esri"+_4e+"SliderTL";break;case "top-right":_50="esri"+_4e+"SliderTR";break;case "bottom-left":_50="esri"+_4e+"SliderBL";break;case "bottom-right":_50="esri"+_4e+"SliderBR";break;default:break;}}return "esri"+_4e+"Slider"+" "+_4f+" "+_50;},_openLogoLink:function(evt){window.open(_10.defaults.map.logoLink,"_blank");_7.stop(evt);},enableMapNavigation:function(){this.navigationManager.enableNavigation();},disableMapNavigation:function(){this.navigationManager.disableNavigation();},enableDoubleClickZoom:function(){if(!this.isDoubleClickZoom){this.navigationManager.enableDoubleClickZoom();this.isDoubleClickZoom=true;}},disableDoubleClickZoom:function(){if(this.isDoubleClickZoom){this.navigationManager.disableDoubleClickZoom();this.isDoubleClickZoom=false;}},enableShiftDoubleClickZoom:function(){if(!this.isShiftDoubleClickZoom){_19(this.declaredClass+": "+_1b,null,"v2.0");this.navigationManager.enableShiftDoubleClickZoom();this.isShiftDoubleClickZoom=true;}},disableShiftDoubleClickZoom:function(){if(this.isShiftDoubleClickZoom){_19(this.declaredClass+": "+_1b,null,"v2.0");this.navigationManager.disableShiftDoubleClickZoom();this.isShiftDoubleClickZoom=false;}},enableClickRecenter:function(){if(!this.isClickRecenter){this.navigationManager.enableClickRecenter();this.isClickRecenter=true;}},disableClickRecenter:function(){if(this.isClickRecenter){this.navigationManager.disableClickRecenter();this.isClickRecenter=false;}},enablePan:function(){if(!this.isPan){this.navigationManager.enablePan();this.isPan=true;}},disablePan:function(){if(this.isPan){this.navigationManager.disablePan();this.isPan=false;}},enableRubberBandZoom:function(){if(!this.isRubberBandZoom){this.navigationManager.enableRubberBandZoom();this.isRubberBandZoom=true;}},disableRubberBandZoom:function(){if(this.isRubberBandZoom){this.navigationManager.disableRubberBandZoom();this.isRubberBandZoom=false;}},enableKeyboardNavigation:function(){if(!this.isKeyboardNavigation){this.navigationManager.enableKeyboardNavigation();this.isKeyboardNavigation=true;}},disableKeyboardNavigation:function(){if(this.isKeyboardNavigation){this.navigationManager.disableKeyboardNavigation();this.isKeyboardNavigation=false;}},enableScrollWheelZoom:function(){if(!this.isScrollWheelZoom){this.navigationManager.enableScrollWheelZoom();this.isScrollWheelZoom=true;}},disableScrollWheelZoom:function(){if(this.isScrollWheelZoom){this.navigationManager.disableScrollWheelZoom();this.isScrollWheelZoom=false;}},showPanArrows:function(){if(this._navDiv){this._navDiv.style.display="block";this.isPanArrows=true;}},hidePanArrows:function(){if(this._navDiv){this._navDiv.style.display="none";this.isPanArrows=false;}},showZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","visible");this.isZoomSlider=true;}},hideZoomSlider:function(){if(this._slider){ds(this._slider.domNode||this._slider,"visibility","hidden");this.isZoomSlider=false;}}});if(has("extend-esri")){_f.Map=Map;}return Map;});